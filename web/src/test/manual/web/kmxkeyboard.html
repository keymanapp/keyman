<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- Set the viewport width to match phone and tablet device widths -->
    <meta name="viewport" content="width=device-width,user-scalable=no" />

    <!-- Allow KeymanWeb to be saved to the iPhone home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <!-- Enable IE9 Standards mode -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>KeymanWeb Khmer KMX/JS test page</title>

    <!-- Your page CSS -->
    <style type='text/css'>
      body {font-family: Tahoma,helvetica;}
      h3 {font-size: 1em;font-weight:normal;color: darkred; margin-bottom: 4px}
      .test {font-size: 24px; width:80%; min-height:30px; border: 1px solid gray;}
      #KeymanWebControl {width:50%;min-width:600px;}
    </style>

    <!-- Insert uncompiled KeymanWeb source scripts -->
    <script src="../../../../build/publish/debug/keymanweb.js" type="application/javascript"></script>

    <!--
      For desktop browsers, a script for the user interface must be inserted here.

      Standard UIs are toggle, button, float and toolbar.
      The toolbar UI is best for any page designed to support keyboards for
      a large number of languages.
    -->
    <script src="../../../../build/publish/debug/kmwuitoggle.js"></script>

    <!-- Initialization: set paths to keyboards, resources and fonts as required -->
    <script>
        const searchParams = new URLSearchParams(window.location.search);
        const filename = searchParams.get('keyboard') || '/build/test-resources/keyboards/khmer_angkor.kmx';
        const kmx = {
            id: 'khmer_angkor',
            name: 'Khmer Angkor',
            languages: { id: 'km', name: 'Khmer' },
            filename: filename
          };
        let keyboard;
        switch (searchParams.get('type')) {
          case 'js':
            keyboard = { id: 'khmer_angkor', name: 'Khmer Angkor', languages: { id: 'km' } };
            break;
          case 'kmx':
          default:
            keyboard = kmx;
            break;
        };
        // allow to wait on KMW being fully initialized
        window.KmwLoaded = new Promise((resolveKmwLoaded) => {
          window.addEventListener('load', async function () {
            await keyman.init();
            await keyman.addKeyboards(keyboard);
            // allow to wait on OSK being visible; `window.OskShown` waited on
            // by keyboard.tests.ts
            window.OskShown = new Promise(resolveOskShown => {
              keyman.osk.addEventListener('show', resolveOskShown);
            });
            resolveKmwLoaded(true);
          });
        });
    </script>

    <!-- Add keyboard management script for local selection of keyboards to use -->
    <script src="commonHeader.js"></script>

  </head>

<!-- Sample page HTML -->
  <body>
    <h2>KeymanWeb Sample Page - Khmer Angkor KMX and JS Keyboards</h2>

    <div>
    <!--
      The following DIV is used to position the Button or Toolbar User Interfaces on the page.
      If omitted, those User Interfaces will appear at the top of the document body.
      (It is ignored by other User Interfaces.)
    -->
    <div id='KeymanWebControl'></div>

    <p>This page allows to use either the .kmx or the .js version of the Khmer Angkor
      keyboard (or whatever .kmx keyboard specified by the <code>keyboard</code> query
      parameter).
      Which one can be selected by the <code>type</code> query parameter:
      append <code>?type=kmx</code> or <code>?type=js</code> to the URL.
      The default is to use the .kmx version.
    </p>
    <h3>Type Khmer in this text area:</h3>
    <textarea id='inputarea' class='test' placeholder='Type here'></textarea>

    <h3><a href="./">Return to testing home page</a></h3>
  </div>

  <!-- include a blank div to enable scrolling -->
  <div style="height:1000px"></div>
  <p>--End of Document--</p>

  </body>

  <!--
    *** DEVELOPER NOTE -- FIREFOX CONFIGURATION FOR TESTING ***
    *
    * If the URL bar starts with <b>file://</b>, Firefox may not load the font used
    * to display the special characters used in the On-Screen Keyboard.
    *
    * To work around this Firefox bug, navigate to <b>about:config</b>
    * and set <b>security.fileuri.strict_origin_policy</b> to <b>false</b>
    * while testing.
    *
    * Firefox resolves website-based CSS URI references correctly without needing
    * any configuration change, so this change should only be made for file-based testing.
    *
    ***
  -->
</html>
