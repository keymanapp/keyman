<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>FOP Design: Renderers</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://xmlgraphics.apache.org/"><img class="logoImage" alt="Apache XML Graphics" src="../../images/group-logo.gif" title="Apache XML Graphics is responsible for the creation and maintenance of software for managing the conversion of XML formats to graphical output, and the creation and maintenance of related software components, based on software licensed to the Foundation"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://xmlgraphics.apache.org/fop/"><img class="logoImage" alt="Apache FOP" src="../../images/logo.jpg" title="Apache FOP (Formatting Objects Processor) is the world's first output independent formatter. Output formats currently supported include PDF, PCL, PS, SVG, XML (area tree representation), Print, AWT, MIF and TXT. The primary output target is PDF."></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="xmlgraphics.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../index.html">Home</a>
</li>
<li>
<a class="unselected" href="../../0.94/index.html">Version 0.94</a>
</li>
<li>
<a class="unselected" href="../../0.95/index.html">Version 0.95</a>
</li>
<li>
<a class="unselected" href="../../trunk/index.html">FOP Trunk</a>
</li>
<li class="current">
<a class="selected" href="../../dev/index.html">Development</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache.org</a> &gt; <a href="http://xml.apache.org/">XML Federation</a> &gt; <a href="http://xmlgraphics.apache.org/">xmlgraphics.apache.org</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_1.1', '../../skin/')" id="menu_1.1Title" class="menutitle">About</div>
<div id="menu_1.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/index.html">Basics</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.2', '../../skin/')" id="menu_selected_1.2Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Design</div>
<div id="menu_selected_1.2" class="selectedmenuitemgroup" style="display: block;">
<div onclick="SwitchMenu('menu_1.2.1', '../../skin/')" id="menu_1.2.1Title" class="menutitle">About</div>
<div id="menu_1.2.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/design/index.html">Introduction</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.2.2', '../../skin/')" id="menu_selected_1.2.2Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Core Process</div>
<div id="menu_selected_1.2.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../dev/design/startup.html">Startup</a>
</div>
<div class="menuitem">
<a href="../../dev/design/parsing.html">XML Parsing</a>
</div>
<div class="menuitem">
<a href="../../dev/design/fotree.html">FO Tree</a>
</div>
<div class="menuitem">
<a href="../../dev/design/properties.html">Properties</a>
</div>
<div class="menuitem">
<a href="../../dev/design/layout.html">Layout</a>
</div>
<div class="menuitem">
<a href="../../dev/design/breakpos.html">Break Possibility</a>
</div>
<div class="menuitem">
<a href="../../dev/design/areas.html">Area Tree</a>
</div>
<div class="menupage">
<div class="menupagetitle">Renderers</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.2.3', '../../skin/')" id="menu_1.2.3Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.2.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/design/images.html">Images</a>
</div>
<div class="menuitem">
<a href="../../dev/design/pdf-library.html">PDF Library</a>
</div>
<div class="menuitem">
<a href="../../dev/design/svg.html">SVG</a>
</div>
<div class="menuitem">
<a href="../../dev/design/embedding.html">Embedding</a>
</div>
<div class="menuitem">
<a href="../../dev/design/extending.html">Extending</a>
</div>
<div class="menuitem">
<a href="../../dev/design/optimise.html">Optimisations</a>
</div>
<div class="menuitem">
<a href="../../dev/design/useragent.html">User Agent</a>
</div>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/xmlgraphics-fop/FOPProjectPages">Unresolved (Wiki)</a>
</div>
<div class="menuitem">
<a href="../../dev/svg.html">SVG</a>
</div>
<div class="menuitem">
<a href="../../dev/extensions.html">Extensions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.3', '../../skin/')" id="menu_1.3Title" class="menutitle">Develop</div>
<div id="menu_1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/api-doc.html">API Doc</a>
</div>
<div class="menuitem">
<a href="../../dev/implement.html">Walk-Thru</a>
</div>
<div class="menuitem">
<a href="http://issues.apache.org/bugzilla/buglist.cgi?bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&email1=&emailtype1=substring&emailassigned_to1=1&email2=&emailtype2=substring&emailreporter2=1&bugidtype=include&bug_id=&changedin=&votes=&chfieldfrom=&chfieldto=Now&chfieldvalue=&product=Fop&short_desc=%5BPATCH%5D&short_desc_type=allwordssubstr&long_desc=&long_desc_type=allwordssubstr&bug_file_loc=&bug_file_loc_type=allwordssubstr&keywords=&keywords_type=anywords&field0-0-0=noop&type0-0-0=noop&value0-0-0=&namedcmd=Fop+all&newqueryname=fop+patch+queue&tofooter=1&order=Reuse+same+sort+as+last+time">Patch Queue</a>
</div>
<div class="menuitem">
<a href="../../dev/conventions.html">Conventions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4', '../../skin/')" id="menu_1.4Title" class="menutitle">Test</div>
<div id="menu_1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/testing.html">Testing</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.5', '../../skin/')" id="menu_1.5Title" class="menutitle">Deploy</div>
<div id="menu_1.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/doc.html">Doc Mgmt</a>
</div>
<div class="menuitem">
<a href="../../dev/release.html">Release</a>
</div>
<div class="menuitem">
<a href="http://issues.apache.org/bugzilla/buglist.cgi?bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&email1=&emailtype1=substring&emailassigned_to1=1&email2=&emailtype2=substring&emailreporter2=1&bugidtype=include&bug_id=&changedin=&votes=&chfieldfrom=&chfieldto=Now&chfieldvalue=&product=Fop&short_desc=&short_desc_type=allwordssubstr&long_desc=&long_desc_type=allwordssubstr&bug_file_loc=&bug_file_loc_type=allwordssubstr&keywords=&keywords_type=anywords&field0-0-0=noop&type0-0-0=noop&value0-0-0=&order=bugs.component">Bugs</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.6', '../../skin/')" id="menu_1.6Title" class="menutitle">Resources</div>
<div id="menu_1.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/faq.html">FAQs</a>
</div>
<div class="menuitem">
<a href="../../dev/tools.html">Tools</a>
</div>
<div class="menuitem">
<a href="http://svn.apache.org/viewvc/xmlgraphics/fop">ViewVC</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.7', '../../skin/')" id="menu_1.7Title" class="menutitle">SubPackages</div>
<div id="menu_1.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/rtflib.html">RTFlib</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="raw XML" class="xmllink">
<a class="dida" href="renderers.xml"><img alt="XML - icon" src="../../skin/images/xmldoc.gif" class="skin"><br>
        XML</a>
</div>
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="renderers.pdf"><img alt="PDF -icon" src="../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<div class="trail">Font size: 
	          &nbsp;<input value="Reset" class="resetfont" title="Reset text" onclick="ndeSetTextSize('reset'); return false;" type="button">      
	          &nbsp;<input value="-a" class="smallerfont" title="Shrink text" onclick="ndeSetTextSize('decr'); return false;" type="button">
	          &nbsp;<input value="+a" class="biggerfont" title="Enlarge text" onclick="ndeSetTextSize('incr'); return false;" type="button">
</div>
<h1>FOP Design: Renderers</h1>
<div id="front-matter">
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#intro">Introduction</a>
</li>
<li>
<a href="#issues">Design Issues</a>
<ul class="minitoc">
<li>
<a href="#issue-renderers-responsible">Renderers are Responsible</a>
</li>
<li>
<a href="#issue-output-stream">Send Output to a Stream</a>
</li>
</ul>
</li>
<li>
<a href="#fonts">Fonts</a>
</li>
<li>
<a href="#context">Render Context</a>
</li>
<li>
<a href="#XML+Handling">XML Handling</a>
</li>
<li>
<a href="#Extensions">Extensions</a>
</li>
<li>
<a href="#implement">Renderer Implementations</a>
</li>
<li>
<a href="#add">Adding a Renderer</a>
</li>
<li>
<a href="#multiple">Multiple Renderers</a>
</li>
<li>
<a href="#status">Status</a>
<ul class="minitoc">
<li>
<a href="#status-todo">To Do</a>
</li>
<li>
<a href="#status-wip">Work In Progress</a>
</li>
<li>
<a href="#status-complete">Completed</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
    
<a name="N10018"></a><a name="intro"></a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p>A renderer is primarily designed to convert a given area tree into the output
document format. It should be able to produce pages and fill the pages
with the text and graphical content. Usually the output is sent to
an output stream.</p>
<p>Some output formats may support extra information that is not available
from the area tree or depends on the destination of the document.</p>
<p>Each renderer is given an area tree to render to its output format.
The area tree is simply a representation of the pages and the placement
of text and graphical objects on those pages.</p>
<p>The renderer will be given each page as it is ready and an output stream
to write the data out.
All pages are supplied in the order they appear in the document.
In order to save memory it is
possble to render the pages out of order. Any page that is not ready to
be rendered is setup by the renderer first so that it can reserve a space
or reference for when the page is ready to be rendered.The renderer is responsible for managing the
output format and associated data and flow.</p>
</div>
    
<a name="N1002B"></a><a name="issues"></a>
<h2 class="underlined_10">Design Issues</h2>
<div class="section">
<a name="N10031"></a><a name="issue-renderers-responsible"></a>
<h3 class="underlined_5">Renderers are Responsible</h3>
<p>Each renderer is totally responsible for its output format.</p>
<a name="N1003B"></a><a name="issue-output-stream"></a>
<h3 class="underlined_5">Send Output to a Stream</h3>
</div>
    
<a name="N10043"></a><a name="fonts"></a>
<h2 class="underlined_10">Fonts</h2>
<div class="section">
<p>Because font metrics (and therefore layout) are obtained in two different ways depending on the renderer, the renderer actually sets up the fonts being used. The font metrics are used
during the layout process to determine the size of characters.</p>
</div>
    
<a name="N1004D"></a><a name="context"></a>
<h2 class="underlined_10">Render Context</h2>
<div class="section">
<p>The render context is used by handlers.
It contains information about the current state of the renderer, such as the page, the position, and any other miscellanous objects that are required to draw into the page.</p>
</div>
    
<a name="N10057"></a><a name="XML+Handling"></a>
<h2 class="underlined_10">XML Handling</h2>
<div class="section">
<p>A document may contain information in the form of XML for an image or instream foreign object.
This XML is handled through the user agent.
A standard extension for PDF is the SVG handler.</p>
<p>If there is XML in the SVG namespace it is given to the handler which renders the SVG into the pdf document at the given location.
This separation means that other XML handlers can easily be added.</p>
</div>
    
<a name="N10064"></a><a name="Extensions"></a>
<h2 class="underlined_10">Extensions</h2>
<div class="section">
<p>Document level extensions are handled with an extension handler.
This handles the information from the AreaTree and adds renders it to the document.
An example is the pdf bookmarks. This information first needs to have all references resolved.
Then the extension handler is ready to put the information into the pdf document.</p>
</div>
    
<a name="N1006E"></a><a name="implement"></a>
<h2 class="underlined_10">Renderer Implementations</h2>
<div class="section">
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
          
<th colspan="1" rowspan="1">Name</th>
          <th colspan="1" rowspan="1">Type</th>
          <th colspan="1" rowspan="1">Font Source</th>
          <th colspan="1" rowspan="1">Font Embedding?</th>
          <th colspan="1" rowspan="1">Out of Order Rendering?</th>
          <th colspan="1" rowspan="1">Notes</th>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">PDF</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">FOP</td>
          <td colspan="1" rowspan="1">Yes</td>
          <td colspan="1" rowspan="1">Yes</td>
          <td colspan="1" rowspan="1">Uses the PDFDocument classes to create a PDF document. Most of the work is to insert text or create lines. SVG is handled by the XML handler that uses the PDFGraphics2D and batik to
draw the svg into the pdf page.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">PostScript</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">FOP</td>
          <td colspan="1" rowspan="1">Not implemented</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">Similar to PDF.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">PCL</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">FOP</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">Similar to PDF.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">SVG</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">Creates a single svg document that contains all the pages rendered
with page sequences horizontally and pages vertically. Adds
links between the pages so that it can be viewed by clicking on the page
to go to the next page.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">TXT</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">No</td>
          <td colspan="1" rowspan="1">Outputs to a text document.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">AWT</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">AWT</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">This draws the pages into an AWT graphic.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">XML</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">FOP</td>
          <td colspan="1" rowspan="1">No</td>
          <td colspan="1" rowspan="1">No</td>
          <td colspan="1" rowspan="1">Creates an XML file that represents the AreaTree.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">Print</td>
          <td colspan="1" rowspan="1">Paginated</td>
          <td colspan="1" rowspan="1">AWT</td>
          <td colspan="1" rowspan="1">?</td>
          <td colspan="1" rowspan="1">No</td>
          <td colspan="1" rowspan="1">Prints the document using the java printing facitlities. The AWT
rendering is used to draw the pages onto the printjob.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">RTF</td>
          <td colspan="1" rowspan="1">Structural</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">No</td>
          <td colspan="1" rowspan="1">Structural format uses a different rendering mechanism.</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">MIF</td>
          <td colspan="1" rowspan="1">Structural</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">N/A</td>
          <td colspan="1" rowspan="1">No</td>
          <td colspan="1" rowspan="1">Structural format uses a different rendering mechanism.</td>
        
</tr>
      
</table>
</div>
    
<a name="N101E3"></a><a name="add"></a>
<h2 class="underlined_10">Adding a Renderer</h2>
<div class="section">
<p>You can add other renderers by implementing the Renderer interface.
However, the AbstractRenderer does most of what is needed, including iterating through the tree parts, so it is probably better to extend this.
This means that you only need to implement the basic functionality such as text, images, and lines.
AbstractRenderer's methods can easily be overridden to handle things in a different way or do some extra processing.</p>
<p>The relevent AreaTree structures that will need to be rendered are:</p>
<ul>
        
<li>Page</li>
        
<li>Viewport</li>
        
<li>Region</li>
        
<li>Span</li>
        
<li>Block</li>
        
<li>Line</li>
        
<li>Inline</li>
      
</ul>
<p>A renderer implementation does the following:</p>
<ul>
        
<li>render each individual page</li>
        
<li>clip and align child areas to a viewport</li>
        
<li>handle all types of inline area, text, image etc.</li>
        
<li>draw various lines and rectangles</li>
      
</ul>
</div>
    
<a name="N1021A"></a><a name="multiple"></a>
<h2 class="underlined_10">Multiple Renderers</h2>
<div class="section">
<p>The layout of the document depends mainly on the font being used.
If two renderers have the same font metrics then it is possible to use the same Area Tree to render both. This can be handled by the AreaTree Handler.</p>
</div>
    
<a name="N10224"></a><a name="status"></a>
<h2 class="underlined_10">Status</h2>
<div class="section">
<a name="N1022A"></a><a name="status-todo"></a>
<h3 class="underlined_5">To Do</h3>
<a name="N10231"></a><a name="status-wip"></a>
<h3 class="underlined_5">Work In Progress</h3>
<a name="N10238"></a><a name="status-complete"></a>
<h3 class="underlined_5">Completed</h3>
<ul>
          
<li>new renderer model</li>
          
<li>new interface for structured documents, rtf and mif</li>
          
<li>added handlers for xml in renderer</li>
        
</ul>
</div>
  
<p align="right">
<font size="-2">by&nbsp;Keiron Liddle</font>
</p>
<span class="version">
          version 627324</span>
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         1999-2008 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
