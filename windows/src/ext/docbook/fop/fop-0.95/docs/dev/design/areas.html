<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>FOP Design: Area Tree</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://xmlgraphics.apache.org/"><img class="logoImage" alt="Apache XML Graphics" src="../../images/group-logo.gif" title="Apache XML Graphics is responsible for the creation and maintenance of software for managing the conversion of XML formats to graphical output, and the creation and maintenance of related software components, based on software licensed to the Foundation"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://xmlgraphics.apache.org/fop/"><img class="logoImage" alt="Apache FOP" src="../../images/logo.jpg" title="Apache FOP (Formatting Objects Processor) is the world's first output independent formatter. Output formats currently supported include PDF, PCL, PS, SVG, XML (area tree representation), Print, AWT, MIF and TXT. The primary output target is PDF."></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="xmlgraphics.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../index.html">Home</a>
</li>
<li>
<a class="unselected" href="../../0.94/index.html">Version 0.94</a>
</li>
<li>
<a class="unselected" href="../../0.95/index.html">Version 0.95</a>
</li>
<li>
<a class="unselected" href="../../trunk/index.html">FOP Trunk</a>
</li>
<li class="current">
<a class="selected" href="../../dev/index.html">Development</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache.org</a> &gt; <a href="http://xml.apache.org/">XML Federation</a> &gt; <a href="http://xmlgraphics.apache.org/">xmlgraphics.apache.org</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_1.1', '../../skin/')" id="menu_1.1Title" class="menutitle">About</div>
<div id="menu_1.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/index.html">Basics</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.2', '../../skin/')" id="menu_selected_1.2Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Design</div>
<div id="menu_selected_1.2" class="selectedmenuitemgroup" style="display: block;">
<div onclick="SwitchMenu('menu_1.2.1', '../../skin/')" id="menu_1.2.1Title" class="menutitle">About</div>
<div id="menu_1.2.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/design/index.html">Introduction</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.2.2', '../../skin/')" id="menu_selected_1.2.2Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Core Process</div>
<div id="menu_selected_1.2.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../dev/design/startup.html">Startup</a>
</div>
<div class="menuitem">
<a href="../../dev/design/parsing.html">XML Parsing</a>
</div>
<div class="menuitem">
<a href="../../dev/design/fotree.html">FO Tree</a>
</div>
<div class="menuitem">
<a href="../../dev/design/properties.html">Properties</a>
</div>
<div class="menuitem">
<a href="../../dev/design/layout.html">Layout</a>
</div>
<div class="menuitem">
<a href="../../dev/design/breakpos.html">Break Possibility</a>
</div>
<div class="menupage">
<div class="menupagetitle">Area Tree</div>
</div>
<div class="menuitem">
<a href="../../dev/design/renderers.html">Renderers</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.2.3', '../../skin/')" id="menu_1.2.3Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.2.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/design/images.html">Images</a>
</div>
<div class="menuitem">
<a href="../../dev/design/pdf-library.html">PDF Library</a>
</div>
<div class="menuitem">
<a href="../../dev/design/svg.html">SVG</a>
</div>
<div class="menuitem">
<a href="../../dev/design/embedding.html">Embedding</a>
</div>
<div class="menuitem">
<a href="../../dev/design/extending.html">Extending</a>
</div>
<div class="menuitem">
<a href="../../dev/design/optimise.html">Optimisations</a>
</div>
<div class="menuitem">
<a href="../../dev/design/useragent.html">User Agent</a>
</div>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/xmlgraphics-fop/FOPProjectPages">Unresolved (Wiki)</a>
</div>
<div class="menuitem">
<a href="../../dev/svg.html">SVG</a>
</div>
<div class="menuitem">
<a href="../../dev/extensions.html">Extensions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.3', '../../skin/')" id="menu_1.3Title" class="menutitle">Develop</div>
<div id="menu_1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/api-doc.html">API Doc</a>
</div>
<div class="menuitem">
<a href="../../dev/implement.html">Walk-Thru</a>
</div>
<div class="menuitem">
<a href="http://issues.apache.org/bugzilla/buglist.cgi?bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&email1=&emailtype1=substring&emailassigned_to1=1&email2=&emailtype2=substring&emailreporter2=1&bugidtype=include&bug_id=&changedin=&votes=&chfieldfrom=&chfieldto=Now&chfieldvalue=&product=Fop&short_desc=%5BPATCH%5D&short_desc_type=allwordssubstr&long_desc=&long_desc_type=allwordssubstr&bug_file_loc=&bug_file_loc_type=allwordssubstr&keywords=&keywords_type=anywords&field0-0-0=noop&type0-0-0=noop&value0-0-0=&namedcmd=Fop+all&newqueryname=fop+patch+queue&tofooter=1&order=Reuse+same+sort+as+last+time">Patch Queue</a>
</div>
<div class="menuitem">
<a href="../../dev/conventions.html">Conventions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4', '../../skin/')" id="menu_1.4Title" class="menutitle">Test</div>
<div id="menu_1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/testing.html">Testing</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.5', '../../skin/')" id="menu_1.5Title" class="menutitle">Deploy</div>
<div id="menu_1.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/doc.html">Doc Mgmt</a>
</div>
<div class="menuitem">
<a href="../../dev/release.html">Release</a>
</div>
<div class="menuitem">
<a href="http://issues.apache.org/bugzilla/buglist.cgi?bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&email1=&emailtype1=substring&emailassigned_to1=1&email2=&emailtype2=substring&emailreporter2=1&bugidtype=include&bug_id=&changedin=&votes=&chfieldfrom=&chfieldto=Now&chfieldvalue=&product=Fop&short_desc=&short_desc_type=allwordssubstr&long_desc=&long_desc_type=allwordssubstr&bug_file_loc=&bug_file_loc_type=allwordssubstr&keywords=&keywords_type=anywords&field0-0-0=noop&type0-0-0=noop&value0-0-0=&order=bugs.component">Bugs</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.6', '../../skin/')" id="menu_1.6Title" class="menutitle">Resources</div>
<div id="menu_1.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/faq.html">FAQs</a>
</div>
<div class="menuitem">
<a href="../../dev/tools.html">Tools</a>
</div>
<div class="menuitem">
<a href="http://svn.apache.org/viewvc/xmlgraphics/fop">ViewVC</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.7', '../../skin/')" id="menu_1.7Title" class="menutitle">SubPackages</div>
<div id="menu_1.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/rtflib.html">RTFlib</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="raw XML" class="xmllink">
<a class="dida" href="areas.xml"><img alt="XML - icon" src="../../skin/images/xmldoc.gif" class="skin"><br>
        XML</a>
</div>
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="areas.pdf"><img alt="PDF -icon" src="../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<div class="trail">Font size: 
	          &nbsp;<input value="Reset" class="resetfont" title="Reset text" onclick="ndeSetTextSize('reset'); return false;" type="button">      
	          &nbsp;<input value="-a" class="smallerfont" title="Shrink text" onclick="ndeSetTextSize('decr'); return false;" type="button">
	          &nbsp;<input value="+a" class="biggerfont" title="Enlarge text" onclick="ndeSetTextSize('incr'); return false;" type="button">
</div>
<h1>FOP Design: Area Tree</h1>
<div id="front-matter">
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#intro">Introduction</a>
</li>
<li>
<a href="#structure">Structure</a>
</li>
<li>
<a href="#page">Page</a>
</li>
<li>
<a href="#block">Block Areas</a>
</li>
<li>
<a href="#line-area">Line Areas</a>
</li>
<li>
<a href="#inline">Inline Areas</a>
</li>
<li>
<a href="#repeated-area">Repeated Areas</a>
</li>
<li>
<a href="#traits">Traits</a>
</li>
<li>
<a href="#classes">Classes</a>
<ul class="minitoc">
<li>
<a href="#classes-page">Page Area Classes</a>
</li>
<li>
<a href="#classes-block">Block Area Classes</a>
</li>
<li>
<a href="#classes-inline">Inline Area Classes</a>
</li>
</ul>
</li>
<li>
<a href="#forward-references">Forward References</a>
</li>
<li>
<a href="#caching">Caching</a>
</li>
<li>
<a href="#extensions">Extensions</a>
</li>
<li>
<a href="#handlers">Area Tree Handlers</a>
</li>
<li>
<a href="#status">Status</a>
<ul class="minitoc">
<li>
<a href="#status-todo">To Do</a>
</li>
<li>
<a href="#status-wip">Work in Progress</a>
</li>
<li>
<a href="#status-complete">Completed</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
    
<a name="N10018"></a><a name="intro"></a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p>The Area Tree is an internal representation of the result document, representing pages and their contents.
To make the concepts clearer and easier to understand, the code to implement the area tree matches the areas defined in the XSL-FO specification.</p>
<p>The area tree is created by the layout managers once the layout is decided for a page.
Once a completed page is finished it can then be added to the area tree.
From that point forward, the area tree model can then handle the new page.
The data in the area tree must be minimal and independant.
This means that the data uses less memory and can be serialized to an output stream if needed.</p>
<p>The Area Tree consists of a set of pages, which the actual implemenation places in a set of page sequences.</p>
</div>
    
<a name="N10028"></a><a name="structure"></a>
<h2 class="underlined_10">Structure</h2>
<div class="section">
<p>The area tree is a root element that has a list of page-viewport-areas.
Each page viewport has a page-reference-area which holds the contents of the page.
To handle the processing better FOP does not maintain a list at the root level but lets the area tree model handle each page as it is added.</p>
</div>
    
<a name="N10032"></a><a name="page"></a>
<h2 class="underlined_10">Page</h2>
<div class="section">
<p>A page consists of a page+viewport pair.</p>
<p>The PageViewPort and Page with the regions is created by the
LayoutMasterSet.
The contents are then placed by the layout managers.
Once the layout of a page is complete then it is added to the Area Tree.</p>
<p>Inside the page is a set of RegionViewport+Region pairs for each region on
the page.</p>
<p>A page is made up of five area regions.
These are before, start, body, end and after.
Each region has a viewport and contains the areas produced from the children in the FO object heirarchy.</p>
<p>For the body area there are more subdivisions for before floats, footnotes and the main reference area.
The main reference area is made from span areas which have normal flow reference areas as children.
The flow areas are then created inside these normal flow reference areas.</p>
<p>Since the layout is done inside a page, the page is created from the pagemaster with all the appropriate areas.
The layout manager then uses the page to add areas into the normal flow reference areas and floats and footnotes.
After adding the areas for the body region then the other regions can be done layed out and added.</p>
</div>
    
<a name="N1004B"></a><a name="block"></a>
<h2 class="underlined_10">Block Areas</h2>
<div class="section">
<p>Block level areas contain either other blocks or line areas (which is a
special block area).</p>
<p>A block is either positoned or stacked with other block areas.</p>
<p>Block areas are created and/or returned by all top level elements in the flow.
The spacing between block areas is handled by an empty block area.
A block area is stacked with other block areas in a particular direction, it has a size and it contains line areas made from a group of inline areas and/or block areas.</p>
</div>
    
<a name="N1005B"></a><a name="line-area"></a>
<h2 class="underlined_10">Line Areas</h2>
<div class="section">
<p>A line areas is simply a collection of inline areas that are stacked in the inline progression direction.
A line area has a height and a start position.
The line area is rendered by handling each inline area.</p>
<p>A line area gets a set of inline areas added until complete then it is justified and vertically alignedi when adding the areas.
If the line area contains unresolved areas then there will be a line resolver that retains the justification information until all areas in the line are resolved.</p>
</div>
    
<a name="N10068"></a><a name="inline"></a>
<h2 class="underlined_10">Inline Areas</h2>
<div class="section">
<p>There are a few different types of inline areas.
All inline areas have a height and width.</p>
<p>Unresolved areas can reserve some space to allow for possible sizes once it is resolved.
Then the line can be re-justified and finalised.</p>
<p>Inline areas are stacked in a line area.
Inline areas are objects such as character, viewport, inline-container, leader and space.
A special inline area Word is also used for a group of consecutive characters.</p>
<p>The image and instream foreign object areas are placed inside a viewport.
The leader (with use content) and unresolved page number areas are resolved to other inline areas.</p>
<p>Once a LineArea is filled with inline areas then the inline areas need to be aligned and adjusted to fill the line properly.</p>
</div>
    
<a name="N1007E"></a><a name="repeated-area"></a>
<h2 class="underlined_10">Repeated Areas</h2>
<div class="section">
<p>There are cases where the same subtree could be repeated in the area tree.
These areas will be returned by the same layout managers.
So it is possible to put a flag on the created areas so that the subtree data can be cached in the output.
Examples of this are: static areas, table header/footer, svg.</p>
</div>
    
<a name="N10088"></a><a name="traits"></a>
<h2 class="underlined_10">Traits</h2>
<div class="section">
<p>A trait is information associated with an area.
This could be information such as text colour or is-first.</p>
<p>Traits provide information about an area.
The traits are derived from properties on the formatting object or are generated during the layout
process.
Many of the layout traits do not have actual values but can be derived from the Area Tree.
Other traits that apply when rendering the areas are set on the area.
Since setting the same value on every area would use a lot of memory then the traits are derived from default or parent values.</p>
<p>A dominant trait on a block area is set, for example font colour, so that
every line area with the same dominant value can derive it.
The text inline areas then get the font colour set on the inline area or from the line area or from the block area.</p>
</div>
    
<a name="N10098"></a><a name="classes"></a>
<h2 class="underlined_10">Classes</h2>
<div class="section">
<p>The following class structure will be used to represent the area tree.</p>
<a name="N100A1"></a><a name="classes-page"></a>
<h3 class="underlined_5">Page Area Classes</h3>
<p>The page area classes hold the top level layout of a page.
The areas are created by the page master and should be ready to have flow areas added.</p>
<a name="N100AB"></a><a name="classes-block"></a>
<h3 class="underlined_5">Block Area Classes</h3>
<p>The block areas hold other block areas and/or line areas.
The child areas are stacked in a particular direction.</p>
<p>Areas for tables, lists and block container have their child block areas stacked in different ways.
These areas a placed with an absolute positioning.
The absolute positioning is where the blocks are placed with an offset from the parent reference area.</p>
<a name="N100B8"></a><a name="classes-inline"></a>
<h3 class="underlined_5">Inline Area Classes</h3>
<p>The inline areas are used to make up a line area.
An inline area typically has a height, width and some content.
The inline area is offset from the baseline of the current line area.
The content of the inline area can be other inline areas or a simple atomic object.</p>
</div>
    
<a name="N100C3"></a><a name="forward-references"></a>
<h2 class="underlined_10">Forward References</h2>
<div class="section">
<p>The Area Tree maintains a set of mappings from the reference to pages.</p>
<p>The PageViewPort holds the list of forward references that need resolving so that if a references is resolved during layout the page can be easily found and then fixed.
Once all the forward references are resolved then the page is ready to be rendered.</p>
<p>To layout a page any areas that cannot be resolved need to reserve space.
Once the inline area is resolved then the complete line should be adjusted to accomodate any change in space used by the area.</p>
</div>
    
<a name="N100D3"></a><a name="caching"></a>
<h2 class="underlined_10">Caching</h2>
<div class="section">
<p>We may need to cache pages due to forward references or when keeping all
pages.</p>
<p>This is done by serializing the Page.
The PageViewport is retained to be used as a key for page references and backward references.
The Page is serialized to an object stream and then all of the page contents are released.
The Page is then recoved by reading from the object stream.</p>
<p>The PageViewport retains information about id areas for easy access.</p>
</div>
    
<a name="N100E3"></a><a name="extensions"></a>
<h2 class="underlined_10">Extensions</h2>
<div class="section">
<p>The Area Tree holds the Output Document extensions.
This is information such as pdf bookmarks or other output document specific information that
is not handled by XSL:FO.</p>
<p>It is also possible to create custom areas that extend a normal area.
The actual data that is rendered could be set in a different way or depend on resolving a forward reference.</p>
</div>
    
<a name="N100F0"></a><a name="handlers"></a>
<h2 class="underlined_10">Area Tree Handlers</h2>
<div class="section">
<p>To handle different situations the handler for the Area Tree handles each
page as it is added.</p>
<p>The RenderPagesModel sends the page directly to the renderer if the page is ready to be rendered. Once a page is rendered it is discarded. The StorePagesModel stores all the pages so that any page can be later accessed.</p>
<p>The Area Tree retains the concept of page sequences (this is not in the area tree in the spec) so that this information can be passed to the renderer.
This is useful for setting the title and organising the groups of page sequences.</p>
</div>
    
<a name="N10100"></a><a name="status"></a>
<h2 class="underlined_10">Status</h2>
<div class="section">
<a name="N10106"></a><a name="status-todo"></a>
<h3 class="underlined_5">To Do</h3>
<a name="N1010D"></a><a name="status-wip"></a>
<h3 class="underlined_5">Work in Progress</h3>
<a name="N10114"></a><a name="status-complete"></a>
<h3 class="underlined_5">Completed</h3>
<ul>
          
<li>new area tree model</li>
          
<li>changed area tree xml format to match the area tree hierarchy</li>
        
</ul>
</div>
  
<p align="right">
<font size="-2">by&nbsp;Keiron Liddle</font>
</p>
<span class="version">
          version 627324</span>
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         1999-2008 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
