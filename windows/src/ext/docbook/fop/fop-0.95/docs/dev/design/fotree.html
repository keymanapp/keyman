<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>FOP Design: FO Tree</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://xmlgraphics.apache.org/"><img class="logoImage" alt="Apache XML Graphics" src="../../images/group-logo.gif" title="Apache XML Graphics is responsible for the creation and maintenance of software for managing the conversion of XML formats to graphical output, and the creation and maintenance of related software components, based on software licensed to the Foundation"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://xmlgraphics.apache.org/fop/"><img class="logoImage" alt="Apache FOP" src="../../images/logo.jpg" title="Apache FOP (Formatting Objects Processor) is the world's first output independent formatter. Output formats currently supported include PDF, PCL, PS, SVG, XML (area tree representation), Print, AWT, MIF and TXT. The primary output target is PDF."></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="xmlgraphics.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../index.html">Home</a>
</li>
<li>
<a class="unselected" href="../../0.94/index.html">Version 0.94</a>
</li>
<li>
<a class="unselected" href="../../0.95/index.html">Version 0.95</a>
</li>
<li>
<a class="unselected" href="../../trunk/index.html">FOP Trunk</a>
</li>
<li class="current">
<a class="selected" href="../../dev/index.html">Development</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache.org</a> &gt; <a href="http://xml.apache.org/">XML Federation</a> &gt; <a href="http://xmlgraphics.apache.org/">xmlgraphics.apache.org</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_1.1', '../../skin/')" id="menu_1.1Title" class="menutitle">About</div>
<div id="menu_1.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/index.html">Basics</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.2', '../../skin/')" id="menu_selected_1.2Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Design</div>
<div id="menu_selected_1.2" class="selectedmenuitemgroup" style="display: block;">
<div onclick="SwitchMenu('menu_1.2.1', '../../skin/')" id="menu_1.2.1Title" class="menutitle">About</div>
<div id="menu_1.2.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/design/index.html">Introduction</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.2.2', '../../skin/')" id="menu_selected_1.2.2Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Core Process</div>
<div id="menu_selected_1.2.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../dev/design/startup.html">Startup</a>
</div>
<div class="menuitem">
<a href="../../dev/design/parsing.html">XML Parsing</a>
</div>
<div class="menupage">
<div class="menupagetitle">FO Tree</div>
</div>
<div class="menuitem">
<a href="../../dev/design/properties.html">Properties</a>
</div>
<div class="menuitem">
<a href="../../dev/design/layout.html">Layout</a>
</div>
<div class="menuitem">
<a href="../../dev/design/breakpos.html">Break Possibility</a>
</div>
<div class="menuitem">
<a href="../../dev/design/areas.html">Area Tree</a>
</div>
<div class="menuitem">
<a href="../../dev/design/renderers.html">Renderers</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.2.3', '../../skin/')" id="menu_1.2.3Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.2.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/design/images.html">Images</a>
</div>
<div class="menuitem">
<a href="../../dev/design/pdf-library.html">PDF Library</a>
</div>
<div class="menuitem">
<a href="../../dev/design/svg.html">SVG</a>
</div>
<div class="menuitem">
<a href="../../dev/design/embedding.html">Embedding</a>
</div>
<div class="menuitem">
<a href="../../dev/design/extending.html">Extending</a>
</div>
<div class="menuitem">
<a href="../../dev/design/optimise.html">Optimisations</a>
</div>
<div class="menuitem">
<a href="../../dev/design/useragent.html">User Agent</a>
</div>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/xmlgraphics-fop/FOPProjectPages">Unresolved (Wiki)</a>
</div>
<div class="menuitem">
<a href="../../dev/svg.html">SVG</a>
</div>
<div class="menuitem">
<a href="../../dev/extensions.html">Extensions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.3', '../../skin/')" id="menu_1.3Title" class="menutitle">Develop</div>
<div id="menu_1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/api-doc.html">API Doc</a>
</div>
<div class="menuitem">
<a href="../../dev/implement.html">Walk-Thru</a>
</div>
<div class="menuitem">
<a href="http://issues.apache.org/bugzilla/buglist.cgi?bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&email1=&emailtype1=substring&emailassigned_to1=1&email2=&emailtype2=substring&emailreporter2=1&bugidtype=include&bug_id=&changedin=&votes=&chfieldfrom=&chfieldto=Now&chfieldvalue=&product=Fop&short_desc=%5BPATCH%5D&short_desc_type=allwordssubstr&long_desc=&long_desc_type=allwordssubstr&bug_file_loc=&bug_file_loc_type=allwordssubstr&keywords=&keywords_type=anywords&field0-0-0=noop&type0-0-0=noop&value0-0-0=&namedcmd=Fop+all&newqueryname=fop+patch+queue&tofooter=1&order=Reuse+same+sort+as+last+time">Patch Queue</a>
</div>
<div class="menuitem">
<a href="../../dev/conventions.html">Conventions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4', '../../skin/')" id="menu_1.4Title" class="menutitle">Test</div>
<div id="menu_1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/testing.html">Testing</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.5', '../../skin/')" id="menu_1.5Title" class="menutitle">Deploy</div>
<div id="menu_1.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/doc.html">Doc Mgmt</a>
</div>
<div class="menuitem">
<a href="../../dev/release.html">Release</a>
</div>
<div class="menuitem">
<a href="http://issues.apache.org/bugzilla/buglist.cgi?bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&email1=&emailtype1=substring&emailassigned_to1=1&email2=&emailtype2=substring&emailreporter2=1&bugidtype=include&bug_id=&changedin=&votes=&chfieldfrom=&chfieldto=Now&chfieldvalue=&product=Fop&short_desc=&short_desc_type=allwordssubstr&long_desc=&long_desc_type=allwordssubstr&bug_file_loc=&bug_file_loc_type=allwordssubstr&keywords=&keywords_type=anywords&field0-0-0=noop&type0-0-0=noop&value0-0-0=&order=bugs.component">Bugs</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.6', '../../skin/')" id="menu_1.6Title" class="menutitle">Resources</div>
<div id="menu_1.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/faq.html">FAQs</a>
</div>
<div class="menuitem">
<a href="../../dev/tools.html">Tools</a>
</div>
<div class="menuitem">
<a href="http://svn.apache.org/viewvc/xmlgraphics/fop">ViewVC</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.7', '../../skin/')" id="menu_1.7Title" class="menutitle">SubPackages</div>
<div id="menu_1.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../dev/rtflib.html">RTFlib</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="raw XML" class="xmllink">
<a class="dida" href="fotree.xml"><img alt="XML - icon" src="../../skin/images/xmldoc.gif" class="skin"><br>
        XML</a>
</div>
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="fotree.pdf"><img alt="PDF -icon" src="../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<div class="trail">Font size: 
	          &nbsp;<input value="Reset" class="resetfont" title="Reset text" onclick="ndeSetTextSize('reset'); return false;" type="button">      
	          &nbsp;<input value="-a" class="smallerfont" title="Shrink text" onclick="ndeSetTextSize('decr'); return false;" type="button">
	          &nbsp;<input value="+a" class="biggerfont" title="Enlarge text" onclick="ndeSetTextSize('incr'); return false;" type="button">
</div>
<h1>FOP Design: FO Tree</h1>
<div id="front-matter">
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#intro">Introduction</a>
</li>
<li>
<a href="#process">Processing</a>
</li>
<li>
<a href="#recycle">Recycling FO Tree Memory</a>
</li>
<li>
<a href="#serialize">FO Tree Serialization</a>
</li>
<li>
<a href="#specific-elements">Notes About Specific Elements</a>
<ul class="minitoc">
<li>
<a href="#page-master">page-master</a>
</li>
<li>
<a href="#flow">flow</a>
</li>
<li>
<a href="#other-elements">Other Elements</a>
</li>
</ul>
</li>
<li>
<a href="#implement">Implementation Notes</a>
<ul class="minitoc">
<li>
<a href="#fonode">FONode</a>
</li>
<li>
<a href="#create-fo">Creating FO Objects</a>
</li>
<li>
<a href="#foreign">Foreign XML</a>
</li>
<li>
<a href="#unknown">Unknown Elements</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
    
<a name="N10018"></a><a name="intro"></a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p>The FO Tree is an internal hierarchical representation (java objects and properties) of the input XSL-FO document, and is created from the <a href="parsing.html">parsing</a> of that XSL-FO document.
The process of building the FO Tree corresponds to the <strong>Objectify</strong> step in the XSL-FO spec.
The FO Tree is an intermediate structure which will later be <a href="layout.html">converted into the area tree</a>.</p>
</div>
    
<a name="N1002D"></a><a name="process"></a>
<h2 class="underlined_10">Processing</h2>
<div class="section">
<p>The SAX Events that are fired by the parsing process are caught by the FO Tree system.
Events for starting an element, ending an element, and text data are assembled by the FO Tree system into a set of objects that represent the input FO document.
A class exists for each element in the XSL-FO set, and an object in the appropriate class is created for each element in the input XSL-FO.</p>
<p>For attributes attached to an XSL-FO element, a property list mapping is used to convert the attribute into properties of the object related to the element.</p>
<p>To the extent possible, validation is checked as the FO Tree is built. An appropriate error message is returned to the user, and processing continues if possible.</p>
<p>Elements from <a href="parsing.html#namespaces">foreign namespaces</a> that are recognized by FOP fall into the following categories:</p>
<ul>
        
<li>Pass-thru: These are placed into a DOM object, which is then passed through FOP directly to the renderer. SVG is an example.</li>
        
<li>FOP Internal: These are placed into objects that can then be used by FOP. An example of this would be an element that the layout process will use to create an area. Another example would be an element that contains setup information for the renderer.</li>
      
</ul>
<p>For unrecognized namespaces, a dummy object or a generic DOM is created.</p>
<p>While the tree building is mainly about creating the FO Tree, some FO Tree events trigger processes in other parts of FOP.
The end of a page-sequence element triggers the layout process for that page-sequence (see discussion of <a href="#recycle">Recycling</a>).
Also, the end of the XML document tells the renderer that it can finalize the output document.</p>
</div>
    
<a name="N10057"></a><a name="recycle"></a>
<h2 class="underlined_10">Recycling FO Tree Memory</h2>
<div class="section">
<p>To minimize the amount of memory used by FOP, we wish to recycle FO Tree memory as much as possible.
There are at least three possible places that FO Tree fragments could be passed to the Layout process, so that their memory can be reused:</p>
<ul>
        
<li>
          
<strong>fo:block</strong> It might be tempting to start laying out pages as soon as the first fo:block object is finished. However, there are many downstream things that can affect the placement of that block on a page, such as graphics and footnotes. So, in order to maintain conformance to the XSL-FO specification, and create high-quality output, we must see more of the document.</li>
        
<li>
          
<strong>fo:root</strong> The other extreme is to wait until the entire document is read in before processing any of it. This essentially means that there is no memory recycling. Processing the document correctly is more important than saving memory, so this option would be used if there were no better alternative.</li>
        
<li>
          
<strong>fo:page-sequence</strong> The page-sequence object provides a nice clean break in the document. Content from one page-sequence will never interfere with nor affect the placement of the content of another. FOP uses this option as the optimum way to maintain compliance with the standard and to minimize memory consumption.</li>
      
</ul>
</div>
    
<a name="N10076"></a><a name="serialize"></a>
<h2 class="underlined_10">FO Tree Serialization</h2>
<div class="section">
<p>This issue is implied by the requirement to process documents of arbitrary size. Unless some arbitrary limit is placed on the size of page-sequence objects, FOP must be able to serialize FO tree fragments as necessary.</p>
</div>
    
<a name="N10080"></a><a name="specific-elements"></a>
<h2 class="underlined_10">Notes About Specific Elements</h2>
<div class="section">
<a name="N10086"></a><a name="page-master"></a>
<h3 class="underlined_5">page-master</h3>
<p>The first elements in a document are the elements for the page master setup.
This is usually only a small number and will be used throughout the document to create new pages.
The root element keeps these objects as a factory to create the page and appropriate regions whenever a new page is requested by the layout.
The objects in the FO Tree that represent these elements are themselves the factory.</p>
<a name="N10090"></a><a name="flow"></a>
<h3 class="underlined_5">flow</h3>
<p>The elements within the flow of a page-sequence are those that are needed for the layout process.
These element will later be used to create areas in the layout process.</p>
<a name="N1009A"></a><a name="other-elements"></a>
<h3 class="underlined_5">Other Elements</h3>
<p>The remaining FO Objects are things like page-sequence, title and color-profile.
Each is handled by its parent element.
The root handles declarations, and declarations maintains a list of colour profiles.
The page-sequences are direct descendants of root.</p>
</div>
    
<a name="N100A5"></a><a name="implement"></a>
<h2 class="underlined_10">Implementation Notes</h2>
<div class="section">
<a name="N100AB"></a><a name="fonode"></a>
<h3 class="underlined_5">FONode</h3>
<p>The base class for all objects in the tree is FONode. The base class for
all FO Objects is FObj (which is a subclass of FONode). Other FONode subclasses are for foreign and unknown XML.</p>
<p>Each FO in FOP has a parent (except root) and a Vector of children. Java inheritance (superclasses and subclasses) is used to enforce constraints required by the FO hierarchy.</p>
<p>FONode, among other things, ensures that each FO has a parent, and provides the mechanism for keeping track of its children.</p>
<p>Each xml element is represented by a java object.
The classes for these objects are grouped into packages for convenience:</p>
<ul>
          
<li>pagination: <span class="codefrag">org.apache.fop.fo.pagination.*</span>
</li>
          
<li>flow: <span class="codefrag">org.apache.fop.fo.flow.*</span>
</li>
          
<li>other: <span class="codefrag">org.apache.fop.fo.*.</span>
</li>
        
</ul>
<a name="N100D0"></a><a name="create-fo"></a>
<h3 class="underlined_5">Creating FO Objects</h3>
<p>The process of creating an FO Object is as follows (see <span class="codefrag">FOTreeBuilder.startElement()</span> for details):</p>
<ul>
          
<li>An FO maker is selected from a hashmap lookup using the namespace and
element name.</li>
          
<li>This maker is then used to create the new object that represents the FO element.</li>
          
<li>The new object is given its element name, an FOUserAgent (for resolving properties, etc.), a logger and its attributes.</li>
          
<li>The new object is added to the FO tree as a child of the current parent.</li>
          
<li>Child elements are then processed. This is an iterative process: the child elements go through the same process here documented for their parent.</li>
        
</ul>
<a name="N100EF"></a><a name="foreign"></a>
<h3 class="underlined_5">Foreign XML</h3>
<p>For SVG, the DOM needs to be created with Batik, so an element mapping is used to read all elements in the SVG namespace and pass them into the Batik DOM.</p>
<p>The base class for foreign XML is XMLObj. This class handles creating a
DOM Element and the setting of attributes. It also can create a DOM
Document if it is a top level element, class XMLElement.
This class must be extended for the namespace of the XML elements. For
unknown namespaces the class is UnknowXMLObj.</p>
<p>If some special processing is needed, then the top level element can extend
the XMLObj. For example the SVGElement makes the special DOM required for
batik and gets the size of the svg.</p>
<p>Foreign XML will usually be in an fo:instream-foreign-object.
The XML will be passed to the renderer as a DOM, which is expected to know how to handle it.
XML from an unknown namespace will be ignored.</p>
<p>See <a href="parsing.html#namespaces">Input Parsing Namespaces</a> for more discussion and links to information about using foreign XML in FOP.</p>
<a name="N10109"></a><a name="unknown"></a>
<h3 class="underlined_5">Unknown Elements</h3>
<p>If an element is in a known namespace but the element is unknown within that namespace, then an Unknown object is created.
This generally indicates an input error: perhaps an element from an older version of the XSL-FO standard, or a misspelling.
The Unknown object is mainly used to provide information to the user.</p>
</div>
  
<p align="right">
<font size="-2">by&nbsp;Keiron Liddle</font>
</p>
<span class="version">
          version 627324</span>
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         1999-2008 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
